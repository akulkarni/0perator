# Development Guide

## MCP Inspector

Use the MCP Inspector to interactively test and debug the MCP server in a web UI:

```bash
./scripts/inspect.sh
```

This opens the inspector at http://127.0.0.1:6274 where you can:
- View available tools and their schemas
- Test tool calls with custom inputs
- See request/response payloads
- Debug issues without an IDE

## Dev Mode for MCP Server

When developing 0perator, you want code changes to take effect immediately without rebuilding and reinstalling the binary. The `--dev` flag enables this workflow.

### Usage

```bash
go run ./cmd/0perator-mcp init --dev
```

### What it does

Instead of configuring IDEs to use the compiled `0perator` binary:

```json
{
  "mcpServers": {
    "0perator": {
      "command": "/usr/local/bin/0perator"
    }
  }
}
```

Dev mode configures IDEs to use `go run`:

```json
{
  "mcpServers": {
    "0perator": {
      "command": "sh",
      "args": ["/path/to/your/repo/cmd/0perator-mcp/scripts/run-source.sh"]
    }
  }
}
```

### Why use dev mode

1. **Instant feedback** - Code changes take effect on the next MCP server restart (when you restart your IDE or reconnect)
2. **No rebuild step** - Skip the `go build && go install` cycle during development
3. **Easy debugging** - Add print statements or modify behavior without deployment friction

### Workflow

1. Run `0perator init --dev` from the repository root
2. Select which IDEs to configure
3. Make code changes to the MCP server
4. Restart your IDE (or reconnect to the MCP server) to pick up changes

### Switching back to production mode

Run `0perator init` without the `--dev` flag to reconfigure IDEs to use the compiled binary.

## Eval Script

The `eval/` directory contains a Python script for testing the MCP server with Claude Code SDK. This is useful for evaluating how Claude interacts with the 0perator tools.

### Prerequisites

- **Python 3.13+** (using pyenv for version management)
  ```bash
  brew install pyenv
  # Add to ~/.zshrc or ~/.bashrc:
  #   export PYENV_ROOT="$HOME/.pyenv"
  #   command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
  #   eval "$(pyenv init -)"
  pyenv install 3.13
  pyenv local 3.13  # in the eval directory
  ```

- **UV package manager**
  ```bash
  curl -LsSf https://astral.sh/uv/install.sh | sh
  ```

- **Node.js 20+** (using nvm for version management)
  ```bash
  nvm install 20
  nvm use 20
  ```

- **Claude Code CLI**
  ```bash
  npm install -g @anthropic-ai/claude-code
  ```

- **Claude Code authentication** - Login via OAuth
  ```bash
  claude login
  ```

- **Tiger CLI** - Authenticated for database operations
  ```bash
  # Install Tiger CLI, then authenticate
  tiger login
  ```

### Running an evaluation

```bash
cd eval
uv run eval.py prompts/saas.md results_1
```

This runs the prompt through Claude Code SDK with the MCP server and saves results to `results_1/`.

### Options

- `--no-mcp` - Disable MCP servers (enabled by default: 0perator, tiger)
- `--no-structured-prompt` - Disable the structured prompt that asks for `<summary>`, `<feedback>`, `<response>` tags

### Output files

Results are saved to the specified directory:

- `output.txt` - Full Claude response
- **`transcript.md`** - **Full conversation transcript with all messages and tool calls. This is the key file to review when debugging or analyzing Claude's behavior.**
- `summary.md` - Extracted `<summary>` content (if present)
- `feedback.md` - Extracted `<feedback>` content (if present)
- `response.txt` - Extracted `<response>` content (if present)
- `out/` - Any files generated by Claude during execution
